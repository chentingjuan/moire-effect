<!DOCTYPE html>
<html>
  <head>
    <title>Moire Effect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js"></script>
    <script src="./p5.min.js"></script>

    <link rel="stylesheet" href="./main.css">
  </head>

  <body>
    <div class="wrapper">
      <canvas id="c"></canvas>
      <canvas id="d"></canvas>
    
      <h1>Moir√© effect is everywhere.</h1>
    </div>
  </body>

  <script>
    let opts = {
      // rot: 2.6,
      // rot: 6,
      rot: 0.6,
      ampl: 800,
    };
    let canvas = document.getElementById("c");
    let danvas = document.getElementById("d");
    let ctx = canvas.getContext("2d");
    let dtx = danvas.getContext("2d");
    let cw = canvas.width = danvas.width = window.innerWidth, cx = cw / 2;
    let ch = canvas.height = danvas.height = window.innerHeight, cy = ch / 2;

    function setup() {
      frameRate(12)
      // let gui = new dat.GUI();
      // gui.add(opts, 'rot', 0, 6.28).step(0.01).onChange(draw);
      // gui.add(opts, 'ampl', 0, 100).onChange(draw);

      noCanvas()
      ctx.lineWidth = 3;
      dtx.lineWidth = 3;

      var grad = ctx.createLinearGradient(-cw/2, ch/2, cw/2, -ch/2);
      grad.addColorStop(0, "rgba(255, 100, 100, 0.2)");
      grad.addColorStop(0.3, "rgba(255, 255, 255, 0.15)");
      grad.addColorStop(0.5, "rgba(255, 255, 255, 0.1)");
      grad.addColorStop(0.7, "rgba(255, 255, 255, 0.15)");
      grad.addColorStop(1, "rgba(100, 100, 255, 0.4)");
      ctx.strokeStyle = grad;

      var gradd = dtx.createLinearGradient(-cw/2, ch/2, cw/2, -ch/2);
      gradd.addColorStop(0, "rgba(255, 100, 100, 0.2)");
      gradd.addColorStop(0.3, "rgba(255, 255, 255, 0.15)");
      gradd.addColorStop(0.5, "rgba(255, 255, 255, 0.1)");
      gradd.addColorStop(0.7, "rgba(255, 255, 255, 0.15)");
      gradd.addColorStop(1, "rgba(100, 100, 255, 0.4)");
      dtx.strokeStyle = gradd;

      // ctx.strokeStyle = `rgba(255, 255, 255, 0.2)`

      ctx.translate(cx, cy);
      dtx.translate(cx, cy);
    }

    function draw() {   
      const counter = frameCount/600
      ctx.clearRect(-cw, -ch, 2*cw, 2*ch);
      dtx.clearRect(-cw, -ch, 2*cw, 2*ch);
      // background(10, 90);
      // ctx.save()
      // ctx.translate(cx, cy);
      noisyLines(counter);
      // ctx.rotate(opts.rot);
      // noisyLines(counter);
      // ctx.restore()
    }

    function noisyLines(timer) {
      let yOffset = 0;
      for(let y = -ch-opts.ampl; y < ch; y+=40){
        let xOffset = timer;
        ctx.save()
        dtx.save()
        ctx.beginPath();
        dtx.rotate(opts.rot);
        dtx.beginPath();
        for(let x = -cw; x < cw; x+=10) {
          // let _y = noise(xOffset, yOffset) * opts.ampl + y
          // let _y = noise(xOffset, yOffset) * opts.ampl + y * noise(timer)
          // let _y = noise(xOffset, yOffset) * opts.ampl + y * sin(timer)
          let _y = noise(xOffset, yOffset) * opts.ampl + y;
          ctx.lineTo(x, _y);
          dtx.lineTo(x, _y);
          xOffset += .01
        }
        ctx.stroke();
        dtx.stroke();

        ctx.restore();
        dtx.restore()

        // ctx.rotate(opts.rot);
        // xOffset = timer;
        // ctx.beginPath();
        // for(let x = -cw; x < cw; x+=10) {
        //   let _y = noise(xOffset, yOffset) * opts.ampl + y;
        //   ctx.lineTo(x, _y);
        //   xOffset += .01
        // }
        // ctx.stroke();
        // ctx.restore()

        yOffset += .02
      }  
    }

  </script>
</html>